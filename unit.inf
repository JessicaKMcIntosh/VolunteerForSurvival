! ------------------------------------------------------------------------------
! Unit - Unit tests for the VTS game code.
!
! Created by Jessica McIntosh
! JessicaKMcIntosh AT gmail DOT com
!
! This work is licensed under the Creative Commons Attribution-ShareAlike 4.0
! International License. See the file LICENSE for details.
! ------------------------------------------------------------------------------

! ------------------------------------------------------------------------------
! Meta Data
! ------------------------------------------------------------------------------

Release 0;

! Replace the Main routine from the standard library.
Replace Main;

! ------------------------------------------------------------------------------
! Libraries
! ------------------------------------------------------------------------------

! Standard libraries.
Include "Parser";
Include "VerbLib";
Include "Grammar";

! Libraries used for testing.
Include "istring";
Include "unit";

! Game specific testing libraries.
Include "testlamp";
Include "testpills";
Include "testtape";

! ------------------------------------------------------------------------------
! Test Objects
! ------------------------------------------------------------------------------

! Fake player.
Object Fake_Player "Fake Player"
;

! ------------------------------------------------------------------------------
! Test Code
! ------------------------------------------------------------------------------

! Prepare objects for each test.
! Resets state for each test so they all have the same starting point.
[ PrepareObjects;
  ! Prepare the player.
  player = Fake_Player;
  deadflag = 0;

  ! Prepare action processing.
  action = nothing;
  inp1 = nothing;
  inp2 = nothing;
  noun = nothing;
  second = nothing;

  ! Prepare the scoring variables.
  score = 0;
  last_score = 0;
  places_score = 0;
  things_score = 0;

  ! Other random variables.
  lookmode = 2;
  turns = 0;

  ! Remove everything from the player object.
  while(child(player)) {
    remove(child(player));
  }
];

! ------------------------------------------------------------------------------
! Run Tests
! ------------------------------------------------------------------------------

! Make the standard library happy.
[ Initialise;
];

! Main function for running the tests.
[ Main;
  print "Running tests for VTS.^^";

  ! Run the Lamp tests.
  PrepareObjects();
  TestLampRun();

  ! Run the Pills tests.
  PrepareObjects();
  TestPillRun();

  ! Run the Tape tests.
  PrepareObjects();
  TestTapeRun();

  Unit_Report();
];